<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sell Your Car - AutoSell Ltd</title>
    <meta name="description" content="Advertise your car with AutoSell Ltd. Reach thousands of potential buyers in Ghana with our professional advertising service.">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🚗</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <div class="nav-container">
                <div class="logo">
                    <div class="logo-icon">
                        <i class="fas fa-car"></i>
                    </div>
                    <span class="logo-text">AutoSell Ltd</span>
                </div>
                <div class="nav-menu" id="navMenu">
                    <a href="index.html" class="nav-link">Home</a>
                    <a href="index.html#browse" class="nav-link">Browse Cars</a>
                    <a href="sell-form.html" class="nav-link active">Sell Your Car</a>
                    <a href="index.html#partner" class="nav-link">Partner With Us</a>
                    <a href="index.html#about" class="nav-link">About</a>
                    <a href="index.html#contact" class="nav-link">Contact</a>
                </div>
                <div class="nav-toggle" id="navToggle">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </nav>
    </header>

    <!-- Sell Form Section -->
    <section class="sell-form-section">
        <div class="container">
            <div class="form-container">
                <div class="form-header">
                    <h1>Advertise Your Car</h1>
                    <p>Fill out the form below to get your car listed on our platform and reach thousands of potential buyers in Ghana.</p>
                </div>

                <form class="sell-form" id="sellForm">
                    <div class="form-group">
                        <label for="sellerName">Full Name *</label>
                        <input type="text" id="sellerName" name="sellerName" required>
                    </div>

                    <div class="form-group">
                        <label for="sellerPhone">Phone Number *</label>
                        <input type="tel" id="sellerPhone" name="sellerPhone" required>
                    </div>

                    <div class="form-group">
                        <label for="sellerLocation">Location *</label>
                        <select id="sellerLocation" name="sellerLocation" required>
                            <option value="">Select your location</option>
                            <option value="Accra">Accra</option>
                            <option value="Kumasi">Kumasi</option>
                            <option value="Tema">Tema</option>
                            <option value="Takoradi">Takoradi</option>
                            <option value="Cape Coast">Cape Coast</option>
                            <option value="Tamale">Tamale</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="carMake">Car Make *</label>
                            <input type="text" id="carMake" name="carMake" placeholder="e.g., Toyota, Honda, BMW" required>
                        </div>

                        <div class="form-group">
                            <label for="carModel">Car Model *</label>
                            <input type="text" id="carModel" name="carModel" placeholder="e.g., Camry, Civic, X5" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="carYear">Year *</label>
                            <select id="carYear" name="carYear" required>
                                <option value="">Select year</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                                <option value="2020">2020</option>
                                <option value="2019">2019</option>
                                <option value="2018">2018</option>
                                <option value="2017">2017</option>
                                <option value="2016">2016</option>
                                <option value="2015">2015</option>
                                <option value="2014">2014</option>
                                <option value="2013">2013</option>
                                <option value="2012">2012</option>
                                <option value="2011">2011</option>
                                <option value="2010">2010</option>
                                <option value="Older">Older</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="carMileage">Mileage (km) *</label>
                            <input type="number" id="carMileage" name="carMileage" placeholder="e.g., 45000" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="carPrice">Asking Price (₵) *</label>
                        <input type="number" id="carPrice" name="carPrice" placeholder="e.g., 150000" required>
                    </div>

                    <div class="form-group">
                        <label for="carCondition">Car Condition *</label>
                        <select id="carCondition" name="carCondition" required>
                            <option value="">Select condition</option>
                            <option value="Excellent">Excellent</option>
                            <option value="Very Good">Very Good</option>
                            <option value="Good">Good</option>
                            <option value="Fair">Fair</option>
                            <option value="Needs Work">Needs Work</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="carDescription">Description *</label>
                        <textarea id="carDescription" name="carDescription" rows="4" placeholder="Describe your car, features, history, reason for selling, etc." required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="carPhotos">Car Photos</label>
                        <div class="photo-upload">
                            <input type="file" id="carPhotos" name="carPhotos" multiple accept="image/*" style="display: none;">
                            <div class="upload-area" id="uploadArea">
                                <i class="fas fa-camera"></i>
                                <p>Click to upload photos</p>
                                <small>Upload up to 10 photos (JPG, PNG)</small>
                            </div>
                            <div id="photoPreview" class="photo-preview" style="display: none;">
                                <h4>Selected Photos:</h4>
                                <div id="photoList" class="photo-list"></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="preferredContact">Preferred Contact Method *</label>
                        <select id="preferredContact" name="preferredContact" required>
                            <option value="">Select contact method</option>
                            <option value="WhatsApp">WhatsApp</option>
                            <option value="Phone Call">Phone Call</option>
                            <option value="Facebook">Facebook</option>
                            <option value="Instagram">Instagram</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="additionalInfo">Additional Information</label>
                        <textarea id="additionalInfo" name="additionalInfo" rows="3" placeholder="Any additional information you'd like to share"></textarea>
                    </div>

                    <div class="form-group checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="agreeTerms" name="agreeTerms" required>
                            <span class="checkmark"></span>
                            I agree to the terms and conditions and understand there is a small fee for this service *
                        </label>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-paper-plane"></i>
                            Submit Listing Request
                        </button>
                        <a href="index.html" class="btn btn-outline">
                            <i class="fas fa-arrow-left"></i>
                            Back to Home
                        </a>
                    </div>
                </form>
            </div>

        </div>
    </section>

    <!-- Professional Info Cards Section -->
    <section class="info-section">
        <div class="container">
            <div class="section-header">
                <h2>Why Choose Our Service?</h2>
                <p>Get maximum exposure for your car with our comprehensive advertising package</p>
            </div>
            
            <div class="info-grid">
                <div class="info-card">
                    <div class="info-icon">
                        <i class="fas fa-star"></i>
                    </div>
                    <h3>What You Get</h3>
                    <ul>
                        <li>Featured placement on our website</li>
                        <li>Social media promotion on Facebook & Instagram</li>
                        <li>Direct buyer contact via WhatsApp</li>
                        <li>Professional listing with detailed specs</li>
                        <li>Quick setup - get listed in minutes</li>
                    </ul>
                </div>

                <div class="info-card">
                    <div class="info-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h3>Process</h3>
                    <ol>
                        <li>Fill out this form</li>
                        <li>We'll review your submission</li>
                        <li>Contact you within 24 hours</li>
                        <li>Pay the small advertising fee</li>
                        <li>Your car goes live immediately</li>
                    </ol>
                </div>

                <div class="info-card">
                    <div class="info-icon">
                        <i class="fas fa-headset"></i>
                    </div>
                    <h3>Need Help?</h3>
                    <p>Contact us directly:</p>
                    <div class="contact-buttons">
                        <a href="https://wa.me/233505677556" class="btn btn-whatsapp" target="_blank">
                            <i class="fab fa-whatsapp"></i>
                            WhatsApp
                        </a>
                        <a href="https://www.facebook.com/profile.php?id=61573682903085" class="btn btn-facebook" target="_blank">
                            <i class="fab fa-facebook"></i>
                            Facebook
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <div class="logo-icon">
                            <i class="fas fa-car"></i>
                        </div>
                        <span class="logo-text">AutoSell Ltd</span>
                    </div>
                    <p>Your trusted platform for car buyers and sellers in Ghana.</p>
                    <div class="social-links">
                        <a href="https://www.facebook.com/profile.php?id=61573682903085" target="_blank"><i class="fab fa-facebook"></i></a>
                        <a href="https://www.instagram.com/autosell_ltd/" target="_blank"><i class="fab fa-instagram"></i></a>
                        <a href="https://wa.me/233505677556" target="_blank"><i class="fab fa-whatsapp"></i></a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="index.html#browse">Browse Cars</a></li>
                        <li><a href="sell-form.html">Sell Your Car</a></li>
                        <li><a href="index.html#partner">Partner With Us</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Services</h4>
                    <ul>
                        <li><a href="sell-form.html">Car Advertising</a></li>
                        <li><a href="index.html#partner">Garage Partnerships</a></li>
                        <li><a href="index.html#browse">Car Listings</a></li>
                        <li><a href="index.html#contact">Contact Support</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact Info</h4>
                    <ul>
                        <li><i class="fab fa-whatsapp"></i> WhatsApp: +233 50 567 7556</li>
                        <li><i class="fab fa-facebook"></i> Facebook: AutoSell Ltd</li>
                        <li><i class="fab fa-instagram"></i> Instagram: @autosell_ltd</li>
                        <li><i class="fas fa-map-marker-alt"></i> Ghana</li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 AutoSell Ltd. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Supabase Configuration -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        // Supabase Configuration - Global scope
        const SUPABASE_URL = 'https://ukeriimrarcdzpnzvawb.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVrZXJpaW1yYXJjZHpwbnp2YXdiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxMzUzNzMsImV4cCI6MjA3MDcxMTM3M30.URWqGo7T9ERgNPyopiMbIs_muvt4_utyDt_GqwKfLBY';
        
        // Initialize Supabase client globally
        const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Initialize form functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Check and create storage bucket if needed
            checkAndCreateStorageBucket();
            
            // Debug: Check if all required elements exist
            console.log('DOM loaded, checking elements...');
            console.log('Upload area:', document.getElementById('uploadArea'));
            console.log('File input:', document.getElementById('carPhotos'));
            console.log('Photo preview:', document.getElementById('photoPreview'));
            console.log('Photo list:', document.getElementById('photoList'));
            console.log('Form:', document.getElementById('sellForm'));
            console.log('Submit button:', document.getElementById('submitBtn'));
            
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('carPhotos');
            
            if (!uploadArea || !fileInput) {
                console.error('Required elements not found!');
                alert('❌ Form elements not loaded properly. Please refresh the page.');
                return;
            }
            
            uploadArea.addEventListener('click', function() {
                console.log('Upload area clicked, triggering file input...');
                fileInput.click();
            });
            
            fileInput.addEventListener('change', function(e) {
                console.log('File input change event:', e.target.files);
                const files = e.target.files;
                const photoPreview = document.getElementById('photoPreview');
                const photoList = document.getElementById('photoList');
                
                if (files.length > 0) {
                    console.log(`Files selected: ${files.length}`);
                    uploadArea.style.display = 'none';
                    photoPreview.style.display = 'block';
                    photoList.innerHTML = ''; // Clear previous previews
                    
                    uploadArea.innerHTML = `
                        <i class="fas fa-check-circle" style="color: var(--success);"></i>
                        <p>${files.length} photo(s) selected</p>
                        <small>Click to change photos</small>
                    `;
                    uploadArea.style.display = 'block';
                    
                    for (let i = 0; i < files.length; i++) {
                        const file = files[i];
                        console.log(`Processing preview for file ${i + 1}:`, file.name);
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.classList.add('preview-image');
                            img.alt = `Photo ${i + 1}`;
                            photoList.appendChild(img);
                            console.log(`Preview created for: ${file.name}`);
                        };
                        reader.readAsDataURL(file);
                    }
                } else {
                    console.log('No files selected, resetting upload area');
                    resetUploadArea();
                }
            });
            
            const form = document.getElementById('sellForm');
            if (form) {
                form.addEventListener('submit', handleFormSubmit);
                console.log('Form submit event listener attached');
            } else {
                console.error('Form element not found!');
            }
        });
        
        // Function to check and create storage bucket
        async function checkAndCreateStorageBucket() {
            try {
                console.log('Checking storage bucket...');
                
                // Try to list files from the bucket to see if it exists
                const { data: files, error: listError } = await supabaseClient.storage
                    .from('car-photos')
                    .list('', { limit: 1 });
                
                if (listError) {
                    if (listError.message.includes('not found') || listError.message.includes('does not exist')) {
                        console.log('Storage bucket does not exist, creating...');
                        
                        // Create the bucket
                        const { data: bucketData, error: createError } = await supabaseClient.storage
                            .createBucket('car-photos', {
                                public: true,
                                allowedMimeTypes: ['image/jpeg', 'image/png', 'image/webp', 'image/gif'],
                                fileSizeLimit: 52428800 // 50MB limit
                            });
                        
                        if (createError) {
                            console.error('Failed to create bucket:', createError);
                            alert('⚠️ Storage bucket creation failed. Please create it manually in Supabase dashboard.');
                        } else {
                            console.log('Storage bucket created successfully:', bucketData);
                            
                            // Set bucket to public
                            const { error: publicError } = await supabaseClient.storage
                                .updateBucket('car-photos', { public: true });
                            
                            if (publicError) {
                                console.warn('Failed to make bucket public:', publicError);
                            } else {
                                console.log('Bucket set to public successfully');
                            }
                        }
                    } else {
                        console.error('Storage error:', listError);
                    }
                } else {
                    console.log('Storage bucket exists and is accessible');
                }
            } catch (error) {
                console.error('Error checking storage bucket:', error);
            }
        }
        
        // Function to reset upload area
        function resetUploadArea() {
            const uploadArea = document.getElementById('uploadArea');
            const photoPreview = document.getElementById('photoPreview');
            const photoList = document.getElementById('photoList');
            
            // Reset upload area to original state
            uploadArea.innerHTML = `
                <i class="fas fa-camera"></i>
                <p>Click to upload photos</p>
                <small>Upload up to 10 photos (JPG, PNG)</small>
            `;
            
            // Hide photo preview
            photoPreview.style.display = 'none';
            photoList.innerHTML = '';
            
            // Re-attach click event
            uploadArea.addEventListener('click', function() {
                document.getElementById('carPhotos').click();
            });
        }
        
        // Form submission handler
        async function handleFormSubmit(e) {
            e.preventDefault();
            
            // Get form data
            const formData = new FormData(this);
            const data = Object.fromEntries(formData);
            
            // Get submit button and store original text
            const submitBtn = document.getElementById('submitBtn');
            const originalText = submitBtn.textContent;
            
            try {
                // Show loading state
                submitBtn.textContent = 'Submitting...';
                submitBtn.disabled = true;
                
                // Handle file uploads first (only if photos are selected)
                let photoUrls = [];
                const photoInput = document.getElementById('carPhotos');
                
                console.log('Photo input:', photoInput);
                console.log('Files selected:', photoInput?.files);
                
                // Check if photo input exists and has files
                if (!photoInput) {
                    console.error('Photo input element not found!');
                    alert('❌ Photo upload system error. Please refresh the page and try again.');
                    return;
                }
                
                if (photoInput.files && photoInput.files.length > 0) {
                    console.log(`Processing ${photoInput.files.length} photos...`);
                    
                    try {
                        for (let i = 0; i < photoInput.files.length; i++) {
                            const file = photoInput.files[i];
                            console.log(`Uploading file ${i + 1}:`, file.name, file.size, file.type);
                            
                            // Validate file type
                            if (!file.type.startsWith('image/')) {
                                console.warn(`Skipping non-image file: ${file.name}`);
                                continue;
                            }
                            
                            // Create unique filename
                            const timestamp = Date.now();
                            const randomId = Math.random().toString(36).substring(2, 15);
                            const fileName = `car_photos/${timestamp}_${randomId}_${file.name}`;
                            
                            console.log(`Uploading to: ${fileName}`);
                            
                            // Upload file to Supabase storage
                            const { data: uploadData, error: uploadError } = await supabaseClient.storage
                                .from('car-photos')
                                .upload(fileName, file, {
                                    cacheControl: '3600',
                                    upsert: false
                                });
                            
                            if (uploadError) {
                                console.error('Photo upload error:', uploadError);
                                alert(`❌ Failed to upload photo ${file.name}: ${uploadError.message}`);
                                continue;
                            } else {
                                console.log('Upload successful:', uploadData);
                                
                                // Get public URL
                                const { data: urlData } = supabaseClient.storage
                                    .from('car-photos')
                                    .getPublicUrl(fileName);
                                
                                if (urlData && urlData.publicUrl) {
                                    photoUrls.push(urlData.publicUrl);
                                    console.log('Photo URL added:', urlData.publicUrl);
                                } else {
                                    console.warn('No public URL generated for:', fileName);
                                }
                            }
                        }
                        
                        console.log(`Total photos uploaded: ${photoUrls.length}`);
                        console.log('Photo URLs:', photoUrls);
                        
                    } catch (photoError) {
                        console.error('Photo processing error:', photoError);
                        alert(`❌ Error processing photos: ${photoError.message}`);
                        // Continue without photos if there's an error
                    }
                } else {
                    console.log('No photos selected for upload');
                }
                
                // Insert data into Supabase
                const submissionData = {
                    car_make: data.carMake,
                    car_model: data.carModel,
                    year: data.carYear,
                    price: parseFloat(data.carPrice),
                    mileage: parseInt(data.carMileage),
                    location: data.sellerLocation,
                    car_condition: data.carCondition,
                    car_description: data.carDescription,
                    seller_name: data.sellerName,
                    seller_phone: data.sellerPhone,
                    seller_email: data.sellerEmail || '',
                    preferred_contact: data.preferredContact,
                    additional_info: data.additionalInfo || '',
                    status: 'new',
                    photos: photoUrls.length > 0 ? photoUrls : null
                };
                
                console.log('Submitting data to Supabase:', submissionData);
                
                const { data: result, error } = await supabaseClient
                    .from('car_submissions')
                    .insert([submissionData]);
                
                if (error) {
                    console.error('Database insert error:', error);
                    throw error;
                }
                
                console.log('Database insert successful:', result);
                
                // Success! Show confirmation
                const photoMessage = photoUrls.length > 0 ? 
                    ` with ${photoUrls.length} photo(s)` : 
                    ' (no photos uploaded)';
                
                alert(`✅ Thank you! Your car has been submitted successfully${photoMessage}. We'll contact you shortly.`);
                
                // Reset form
                this.reset();
                resetUploadArea();
                
                // Also open WhatsApp for immediate contact
                const message = `Hi! I just submitted my car on AutoSell Ltd. Please check your dashboard.`;
                const whatsappUrl = `https://wa.me/233505677556?text=${encodeURIComponent(message)}`;
                window.open(whatsappUrl, '_blank');
                
                // Show WhatsApp instruction
                setTimeout(() => {
                    alert('📱 WhatsApp should have opened. If not, please manually contact us at +233 50 567 7556');
                }, 1000);
                
            } catch (error) {
                console.error('Error submitting form:', error);
                alert(`❌ Sorry, there was an error submitting your form: ${error.message}. Please try again or contact us directly.`);
            } finally {
                // Reset button state
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }
    </script>
</body>
</html>
